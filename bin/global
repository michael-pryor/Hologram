#!/bin/sh -e
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

ENTITY_DIR="${DIR}/apps"

# Individual entity manipulated
if [ "$#" -eq 2 ]; then
   exec "$DIR/run" $@
   exit $?
fi

if [ "$#" -ne 1 ]; then
   echo "Must have one or two arguments e.g:"
   echo "${0} governor start <-- starts the governor"
   echo "${0} start <-- starts all processes"
   exit 1
fi

ACTION="${1}"

case $ACTION in
tail)
  tail -f "${LOG_DIR}"/*.log
  exit 0
;;
esac


for entityFile in "${ENTITY_DIR}"/*
do
  # Strip file path, now we just have e.g. governor.sh
  entityFile=${entityFile##*/}

  # Strip ending so now we just have governor.
  entityName=${entityFile%.*}
  
  "${DIR}/run" $@ "${entityName}"
done

case $ACTION in
audit_daily)
  echo
  echo "Disk space stats"
  df -k --output=pcent ${DIR}
;;
esac
